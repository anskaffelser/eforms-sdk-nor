noticeTypes: [E2]

aliases:
  E2: E2

fields:
  OPT-002-notice:
    pattern:
      value: ^eforms-sdk-\d\.\d#eforms-sdk-#extended#amtl-is-a-god-damn-hero$
  
  BT-01(e)-Procedure:
    mandatory:
      constraints:
        - noticeTypes: E2
          value: true
          severity: ERROR
          nor-tailoring-rationale:
            nob: >-
              Lovhjemmelen for den planlagte anskaffelsen m책 angis.
            nob_verify: false
            nno: >-
              Lovheimelen til den planlagte anskaffinga m책 angivast.
            nno_verify: false
            eng: >-
              The legal basis for the planned procurement must be provided.
            eng_verify: false
            
  BT-01(f)-Procedure: 
    mandatory:
      constraints:
        - noticeTypes: E2
          value: true
          severity: ERROR
          nor-tailoring-rationale:
            nob: >-
              Beskrivelse av lovhjemmelen for den planlagte anskaffelsen m책 angis.
            nob_verify: false
            nno: >-
              Beskriving av lovheimelen til den planlagte anskaffinga m책 angivast.
            nno_verify: false
            eng: >-
              A description of the legal basis for the planned procurement must be provided.
            eng_verify: false
  

rules:
  # /*/cbc:CustomizationID
  OPT-002-notice:
    - id: EFORMS-NOR-R001
      test: matches(normalize-space(),'^eforms-sdk-\d\.(\d{1,2})#extended#amtl-is-a-god-damn-hero$')
      message: Customization identifier must match the Norwegian accepted identifier

  # /*/cbc:NoticeLanguageCode
  BT-702(a)-notice:
    - id: EFORMS-NOR-R002
      test: normalize-space() = ('BUL', 'CES', 'DAN', 'DEU', 'ELL', 'ENG', 'EST', 'FIN', 'FRA', 'GLE', 'HRV', 'HUN', 'ITA', 'LAV', 'LIT', 'MLT', 'NLD', 'POL', 'POR', 'RON', 'SLK', 'SLV', 'SPA', 'SWE', 'NOR', 'NOB', 'NNO')
      message: Main language must be Norwegian or one of the official languages.

  # /*/cac:AdditionalNoticeLanguage/cbc:ID
  BT-702(b)-notice:
    - id: EFORMS-NOR-R003
      test: normalize-space() = ('BUL', 'CES', 'DAN', 'DEU', 'ELL', 'ENG', 'EST', 'FIN', 'FRA', 'GLE', 'HRV', 'HUN', 'ITA', 'LAV', 'LIT', 'MLT', 'NLD', 'POL', 'POR', 'RON', 'SLK', 'SLV', 'SPA', 'SWE', 'NOR', 'NOB', 'NNO')
      message: Additional language must be Norwegian or one of the official languages.

  # /*/ext:UBLExtensions/ext:UBLExtension/ext:ExtensionContent/efext:EformsExtension/efac:NoticeSubType/cbc:SubTypeCode
  OPP-070-notice:
    - id: EFORMS-NOR-R010
      test: normalize-space() = ('E2')
      message: Notice type must be E2.

  BT-01(e)-Procedure:
    - id: EFORMS-NOR-R100
      test: >
        not(
          /*/cac:TenderingTerms
            /cac:ProcurementLegislationDocumentReference
              [normalize-space(cbc:ID) = 'LocalLegalBasis']
        )
        or
        normalize-space(
          /*/cac:TenderingTerms
            /cac:ProcurementLegislationDocumentReference
              [normalize-space(cbc:ID) = 'LocalLegalBasis']
            /cbc:ID
        )
        =
        (
          'Anskaffelsesforskriften Del 1',
          'Anskaffelsesforskriften Del 1 og 2',
          'Forsyningsforskriften Del 1',
          'Konsesjonskontraktforskriften Del 1',
          'Forskrift om forsvars- og sikkerhetsanskaffelser Del 1'
        )
      message: >
        Local legal basis must be one of the recognised Norwegian procurement regulations

  # /*
  ND-Root:
    - id: EFORMS-NOR-R004
      test: normalize-space(cbc:NoticeLanguageCode) = ('NOR', 'NOB', 'NNO') or (some $l in cac:AdditionalNoticeLanguage/cbc:ID satisfies normalize-space($l) = ('NOR', 'NOB', 'NNO')) # then true() else false())
      message: At least one of the official lingustic versions must be in Norwegian.

    - id: EFORMS-NOR-R007
      test: not(/*/ext:UBLExtensions/ext:UBLExtension/ext:ExtensionContent/efext:EformsExtension/efac:NonOfficialLanguages)
      message: Non-official languages are not used for national notices.

  # /*/cbc:IssueDate
  BT-05(a)-notice:
    # Copied from stage 6b
    - id: EFORMS-NOR-R801
      test: ((current-date() - xs:date(text())) le xs:dayTimeDuration('P2D')) and ((current-date() - xs:date(text())) ge xs:dayTimeDuration('-P1D'))
      message: Notice Dispatch Date must be between 0 and 24 hours before the current date.

  BT-536-Part:
    - id: EFORMS-NOR-E2-R001
      test: normalize-space() = /*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Part']/cac:ProcurementProject/cac:PlannedPeriod/cbc:StartDate[1]/normalize-space()
      message: All parts must have the same start date

  BT-537-Part:
    - id: EFORMS-NOR-E2-R002
      test: normalize-space() = /*/cac:ProcurementProjectLot[cbc:ID/@schemeName='Part']/cac:ProcurementProject/cac:PlannedPeriod/cbc:EndDate[1]/normalize-space()
      message: All parts must have the same end date
    

removed: []

