---
meta:
  id: NOR-national-E2-overlay
  noticeType: E2
  version: 0.1.0

rules:
  # ========================================================================== #
  # National legal basis
  # The procurement's legal basis indicates trigger points for increasing 
  # levels of legal complexity, as given by threshold values provided 
  # in the legal act under which the procurement procedure takes place.
  # ========================================================================== #
  - id: NOR-R-NationalLegalBasis-required
    kind: requireBoth
    fields:
      - "BT-01(e)-Procedure"
      - "BT-01(f)-Procedure"
    description:
      nob: >-
        Rettslig grunnlag må angis for nasjonale anskaffelser, jf. FOA Kapittel
        1 og 2.
      nob_verify: false
      nno: >-
        Rettsleg grunnlag må angivast for nasjonale anskaffingar, jf. FOA
        Kapittel 1 og 2.
      nno_verify: false
      eng: >-
        Legal basis must be provided for national procurements, cf. 
        Chapters 1 and 2 of the Norwegian Public Procurement Legislation.
      eng_verify: false
        

  - id: NOR-R-NationalLegalBasis-pair
    kind: literalPairAllowed
    primary: "BT-01(e)-Procedure"
    secondary: "BT-01(f)-Procedure"
    literalPairsRef: "no:legal-basis-procedure-national-literals"
    description: 
      nob: >-
        For nasjonale anskaffelser er gyldige lovhjemler en av følgende:
          1) Forskrift om offentlige anskaffelser
          2) Konsesjonskontraktforskriften
          3) Forsyningsforskriften
          4) Forskrift om forsvars- og sikkerhetsanskaffelser
      nob_verify: false
      nno: >-
        For nasjonale anskaffingar er gyldige lovheimlar ein av følgjande:
          1) Forskrift om offentlege anskaffingar
          2) Konsesjonskontraktsforskrifta
          3) Forsyningsforskrifta
          4) Forskrift om forsvars- og tryggingsanskaffingar
      nno_verify: false
      eng: >-
        For national procurements, valid legal bases are one of the following:
          1) Public Procurement Regulations
          2) Concession Contract Regulations
          3) Utilities Regulations
          4) Defence and Security Procurement Regulations
      eng_verify: false

  # ========================================================================== #
  # The buyer legal type plays a part in determining threshold values, above
  # which notices must be published on TED.
  # Requiring BT-11-Procedure-Buyer in national notices, triggers an underlying
  # form validation rule, ensuring that BT-10-Procedure-Buyer also becomes 
  # strictly required. 
  # ========================================================================== #
  - id: NOR-R-BT11-Procedure-Buyer
    kind: require
    field: "BT-11-Procedure-Buyer"
    description: 
      nob: >-
        Typen oppdragsgiver angir hvem forskriften gjelder, og påvirker
        EØS-terskelverdiene for kunngjøring.
      nob_verify: false
      nno: >-
        Typen oppdragsgivar angir kven forskrifta gjeld, og påverkar
        EØS-terskelverdiane for kunngjering.
      nno_verify: false
      eng: >-
        The buyer legal type determines plays a part in determining the
        threshold values for which a notice must be published on TED.
      eng_verify: false
        
        
  - id: NOR-R-BT10-Procedure-Buyer
    kind: require
    field: "BT-10-Procedure-Buyer"
    description: 
      nob: >-
        Oppdragsgivers hovedaktivitet er obligatorisk. Dette følger av
        underliggende skjemavalideringsregler fra EU-kommisjonen, der BT-10 
        påkreves når BT-11 er angitt. I sum sikrer dette korrekt identifisering
        av oppdragsgivertypen, iht. FOA § 1-2.
      nob_verify: false
      nno: >-
        Oppdragsgivars hovudaktivitet er obligatorisk. Dette følgjer av 
        underliggjande skjemavalideringsreglar frå EU-kommisjonen, der BT-10
        blir påkravd når BT-11 er angitt. I sum sikrar dette korrekt
        identifisering av oppdragsgivartypen, i samsvar med FOA § 1-2.
      nno_verify: false
      eng: >-
        The buyer main activity is mandatory. This follows from underlying 
        form validation rules from the European Commision, where BT-10 becomes
        mandatory when BT-11 is provided. Together, this ensures correct
        identification of the buyer type, in accorrdance with Section 1-2 of 
        the Norwegian Public Procurement Regulations.
        
  # ========================================================================== #
  # Validation that the currency is NOK, in order for the procurement's 
  # (estimated) value to be interpreted correctly in national forms.
  # ========================================================================== #
  - id: NOR-R-BT27-Procedure-Currency-NOK
    kind: fixedValue
    field: "BT-27-Procedure-Currency"
    value: "NOK"
    description: 
      nob: >-
        Estimert verdi må oppgis i norsk valuta (NOK) i nasjonal kunngjøring, 
        jf. FOA § 5-3 og § 5-4.
      nob_verify: false
      nno: >-
        Estimert verdi må oppgivast i norsk valuta (NOK) i nasjonal
        kunngjering, jf. FOA § 5-3 og § 5-4.
      nno_verify: false
      eng: >-
        The procurement's estimated value must be provided in Norwegian
        currency (NOK) for national procurement notices, in accordance with
        Sections 5-3 and 5-4 of the Norwegian Public Procurement Legislations.

  - id: NOR-R-BT27-Part-Currency-NOK
    kind: fixedValue
    field: "BT-27-Part-Currency"
    value: "NOK"
    description: 
      nob: >-
        Estimert verdi må oppgis i norsk valuta (NOK) i nasjonal kunngjøring, jf.
        FOA § 5-3 og § 5-4

  # ========================================================================== #
  # Teknisk validering av at summen av verdiene av delkontraktene skal være
  # lik anskaffelsens verdi (konsistens)
  # ========================================================================== #
  - id: NOR-R-BT27-Procedure-SumOfParts
    kind: sumEquals
    parentField: "BT-27-Procedure"
    childField: "BT-27-Part"
    groupBy: "Procedure"
    currencyFieldParent: "BT-27-Procedure-Currency"
    currencyFieldChild: "BT-27-Part-Currency"
    description: 
      nob: >-
        Anskaffelsens estimerte verdi må samsvare med summen av verdien for
        delkontraktene, jf. FOA § 5-4 (8) og § 5-2
        
  # ========================================================================== #
  # 1. EØS-terskel: Særlige tjenester, helse- og sosialtjenester
  #                 FOA Vedlegg 2 og 3
  # ========================================================================== #
  - id: NOR-R-BT27-Procedure-MaxGeneralSpecialServices
    kind: maximumValue
    field: "BT-27-Procedure"
    value: 7_800_000
    condition: 
      - field: "BT-262-Procedure"
        kind: fixedValue
        value: "cpv"
        description:
          nob: >-
            Forskrift om offentlige anskaffelser identifiserer særlige tjenester,
            og helse- og sosialtjenester, ved CPV-koder angitt i vedleggene 2 og
            3.
      - kind: anyOf
        conditions: 
          - field: "BT-26(m)-Procedure"
            kind: codeAllowed
            codeListRef: "no:foa-appendix-2"
            description:
              nob: >-
                Hoved-CPV-koden er i kodelista for særlige tjenester 
                (Forskrift om offentlige anskaffelser, Vedlegg 2)
          - field: "BT-26(m)-Procedure"
            kind: codeAllowed
            codeListRef: "no:foa-appendix-3"
            description:
              nob: >-
                Hoved-CPV-koden er i kodelista for helse- og sosialtjenester 
                (Forskrift om offentlige anskaffelser, Vedlegg 3)
      - kind: not
        conditions: 
          - field: "BT-10-Procedure-Buyer"
            kind: codeAllowed
            codeListRef: "no:main-activity-utilities"
            description:
              nob: >-
                Forsyningsforskriftens virkeområde knyttes til utøvelsen
                av forsyningsaktiviteter, som beskrevet i Forsyningsforskriftens
                § 1-2.
    description: 
      nob: >-
        Ved nasjonale anskaffelser av særlige tjenester, og helse- og 
        sosialtjenester, jf. FOA § 5-3, må anskaffelsens samlede verdi være
        mindre enn den gjeldende EØS-terskelverdien på 7.8 MNOK.
        
  # ========================================================================== #
  # 2. EØS-terskel: Bygge- og anleggskontrakter, FOA Vedlegg 1
  # ========================================================================== #
  - id: NOR-R-BT27-Procedure-MaxAllWorks
    kind: maximumValue
    field: "BT-27-Procedure"
    value: 57_800_000
    condition: 
      - field: "BT-262-Procedure"
        kind: fixedValue
        value: "cpv"
        description:
          nob: >-
            Forskrift om offentlige anskaffelser identifiserer bygge- og
            anleggskontrakter ved CPV-koder angitt i vedlegg 1.
      - field: "BT-26(m)-Procedure"
        kind: codeAllowed
        codeListRef: "no:foa-appendix-1"
        description:
          nob: >-
            Hoved-CPV-koden er i kodelista for bygge- og anleggskontrakter 
            (Forskrift om offentlige anskaffelser, Vedlegg 1)
    description: 
      nob: >-
        Ved nasjonale anskaffelser av bygge- og anleggsarbeider, 
        jf. FOA § 5-3, må anskaffelsens samlede verdi være mindre enn den
        gjeldende EØS-terskelverdien på 57.8 MNOK.

  # ========================================================================== #
  # 3. EØS-terskel: Forsyningsforskriften
  # ========================================================================== #
  - id: NOR-R-BT27-Procedure-MaxUtilitiesGeneralGoodsServices
    kind: maximumValue
    field: "BT-27-Procedure"
    value: 4_600_000
    condition: 
      - field: "BT-10-Procedure-Buyer"
        kind: codeAllowed
        codeListRef: "no:main-activity-utilities"
        description:
          nob: >-
            Forsyningsforskriftens virkeområde knyttes til utøvelsen
            av forsyningsaktiviteter, som beskrevet i Forsyningsforskriftens
            § 1-2.
      
      - kind: not
        conditions:
          - field: "BT-262-Procedure"
            kind: fixedValue
            value: "cpv"
            description:
              nob: >-
                Forskrift om offentlige anskaffelser identifiserer bygge- og
                anleggskontrakter, særlige tjenester, og helse- og sosialtjenester
                ved CPV-koder angitt i vedlegg 1, 2 og 3.
          - kind: anyOf
            conditions:
            - field: "BT-26(m)-Procedure"
              kind: codeAllowed
              codeListRef: "no:foa-appendix-1"
              description:
                nob: >-
                  Hoved-CPV-koden er i kodelista for bygge- og anleggskontrakter 
                  (Forskrift om offentlige anskaffelser, Vedlegg 1)
            - field: "BT-26(m)-Procedure"
              kind: codeAllowed
              codeListRef: "no:foa-appendix-2"
              description:
                nob: >-
                  Hoved-CPV-koden er i kodelista for særlige tjenester 
                  (Forskrift om offentlige anskaffelser, Vedlegg 2)
            - field: "BT-26(m)-Procedure"
              kind: codeAllowed
              codeListRef: "no:foa-appendix-3"
              description:
                nob: >-
                  Hoved-CPV-koden er i kodelista for helse- og sosialtjenester 
                  (Forskrift om offentlige anskaffelser, Vedlegg 3)
          
    description: 
      nob: >-
        Ved nasjonael anskaffelser knyttet til utførelsen av
        forsyningsaktiviteter, jf. Forsyningsforskriften § 1-2, må
        anskaffelsens totale verdi være mindre enn den gjeldende 
        EØS-terskelverdien på 4.6 MNOK.
        
  - id: NOR-R-BT-27-Procedure-MaxUtilitiesSpecialServices
    kind: maximumValue
    field: "BT-27-Procedure"
    value: 10_400_000
    condition: 
      - field: "BT-262-Procedure"
        kind: fixedValue
        value: "cpv"
      - kind: anyOf
        conditions: 
          - field: "BT-26(m)-Procedure"
            kind: codeAllowed
            codeListRef: "no:foa-appendix-2"
            description:
              nob: >-
                Hoved-CPV-koden er i kodelista for særlige tjenester 
                (Forskrift om offentlige anskaffelser, Vedlegg 2)
          - field: "BT-26(m)-Procedure"
            kind: codeAllowed
            codeListRef: "no:foa-appendix-3"
            description:
              nob: >-
                Hoved-CPV-koden er i kodelista for helse- og sosialtjenester 
                (Forskrift om offentlige anskaffelser, Vedlegg 3)
    description: 
      nob: >-
        Ved nasjonale anskaffelser knyttet til særlige tjenester eller helse-
        og sosialtjenester, jf. Forsyningsforskriftens § 5-2, må anskaffelsens
        samlede verdi være mindre enn den gjeldende EØS-terskelverdien på
        10.6 MNOK.
        
  # ========================================================================= #
  # 4. EØS-terskel: Generelle varer/tjenester, ikke-statsstyrte offentlige
  #                 myndigheter. Gjelder ikke særlige tjenester, helse- og
  #                 sosialtjenester, eller bygge- og anleggsanskaffelser
  # ========================================================================= #
  - id: NOR-R-BT-27-Procedure-RALA-MaxGoodsServices
    kind: maximumValue
    field: "BT-27-Procedure"
    value: 2_300_000
    condition:
      - field: "BT-11-Procedure-Buyer"
        kind: doesNotContain
        value: "cga"

      - kind: not
        conditions: 
          - field: "BT-10-Procedure-Buyer"
            kind: codeAllowed
            codeListRef: "no:main-activity-utilities"
            description:
              nob: >-
                Forsyningsforskriftens virkeområde knyttes til utøvelsen
                av forsyningsaktiviteter, som beskrevet i Forsyningsforskriftens
                § 1-2.

      - kind: not
        conditions:
          - field: "BT-262-Procedure"
            kind: fixedValue
            value: "cpv"
          - kind: anyOf
            conditions: 
              - field: "BT-26(m)-Procedure"
                kind: codeAllowed
                codeListRef: "no:foa-appendix-1"
                description:
                  nob: >-
                    Hoved-CPV-koden er i kodelista for bygge- og anleggskontrakter 
                    (Forskrift om offentlige anskaffelser, Vedlegg 1)
              - field: "BT-26(m)-Procedure"
                kind: codeAllowed
                codeListRef: "no:foa-appendix-2"
                description:
                  nob: >-
                    Hoved-CPV-koden er i kodelista for særlige tjenester 
                    (Forskrift om offentlige anskaffelser, Vedlegg 2)
              - field: "BT-26(m)-Procedure"
                kind: codeAllowed
                codeListRef: "no:foa-appendix-3"
                description:
                  nob: >-
                    Hoved-CPV-koden er i kodelista for helse- og sosialtjenester 
                    (Forskrift om offentlige anskaffelser, Vedlegg 3)
    description: 
      nob: >-
        Ved nasjonale anskaffelser av generelle varer eller tjenester for
        alminnelige offentlige myndigheter, må anskaffelsens samlede verdi være
        mindre enn EØS-terskelverdien på 2.3 MNOK. 

  # ========================================================================= #
  # 5. EØS-terskel: Generelle varer/tjenester, statlige eller statsstyrte 
  #                 offentlige myndigheter. Gjelder ikke særlige tjenester, 
  #                 helse- og sosialtjenester, eller bygge- og 
  #                 anleggsanskaffelser
  # ========================================================================= #
  - id: NOR-R-BT-27-Procedure-CGA-MaxGoodsServices
    kind: maximumValue
    field: "BT-27-Procedure"
    value: 1_490_000
    condition:
      - field: "BT-11-Procedure-Buyer"
        kind: contains
        value: "cga"
      
      - kind: not
        conditions: 
          - field: "BT-10-Procedure-Buyer"
            kind: codeAllowed
            codeListRef: "no:main-activity-utilities"
            description:
              nob: >-
                Forsyningsforskriftens virkeområde knyttes til utøvelsen
                av forsyningsaktiviteter, som beskrevet i Forsyningsforskriftens
                § 1-2.

      - kind: not
        conditions:
          - field: "BT-262-Procedure"
            kind: fixedValue
            value: "cpv"
          - kind: anyOf
            conditions: 
              - field: "BT-26(m)-Procedure"
                kind: codeAllowed
                codeListRef: "no:foa-appendix-1"
                description:
                  nob: >-
                    Hoved-CPV-koden er i kodelista for bygge- og anleggskontrakter 
                    (Forskrift om offentlige anskaffelser, Vedlegg 1)
              - field: "BT-26(m)-Procedure"
                kind: codeAllowed
                codeListRef: "no:foa-appendix-2"
                description:
                  nob: >-
                    Hoved-CPV-koden er i kodelista for særlige tjenester 
                    (Forskrift om offentlige anskaffelser, Vedlegg 2)
              - field: "BT-26(m)-Procedure"
                kind: codeAllowed
                codeListRef: "no:foa-appendix-3"
                description:
                  nob: >-
                    Hoved-CPV-koden er i kodelista for helse- og sosialtjenester 
                    (Forskrift om offentlige anskaffelser, Vedlegg 3)
    description: 
      nob: >-
        Ved nasjonale anskaffelser av generelle varer eller tjenester for
        statlige offentlige myndigheter, må anskaffelsens samlede verdi være
        mindre enn EØS-terskelverdien på 1.49 MNOK. 


